<!DOCTYPE html>
<html lang="default">
<head>
	<meta name="generator" content="Hugo 0.24.1" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="base-url" content="/">
    <link type="image/png" href="https://gw.alipayobjects.com/zos/rmsportal/tRXQtrTrncqqhetSGTQP.png" rel="shortcut icon" />
    <base href="/">
    <link rel="stylesheet" href="/sofastack.github.io/css/sofa.css" rel="stylesheet">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_18677_3gesaak2gctyb9.css">
    <link href="//a.alipayobjects.com/g/lark/lark-markdown/1.3.18/default.css" rel="stylesheet">
    <link href="https://gw.alipayobjects.com/os/skylark/KIxlVLTkLQVFFoYBWDbT.css" rel="stylesheet">
    <link href="https://gw.alipayobjects.com/os/skylark/FEJbjjFlOklxrFRcJlEt.css" rel="stylesheet">
    <title>sofastack</title>
    <script src="https://gw.alipayobjects.com/os/skylark/lzusIxsuPvIxUYowbfNY.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://gw.alipayobjects.com/os/skylark/DNXLotCBHDrtZnOcOSgz.js" type="text/javascript" charset="utf-8"></script>
  </head>
<body data-url="/" class="theme1">
    <div class="header">
  <div>
    <div class="header-wrapper">
      <div class="header-logo">
        <a href=/sofastack.github.io>
          <img src="https://gw.alipayobjects.com/zos/rmsportal/tXhjeqVBFJnDSGScZrcW.png" alt="">
        </a>
      </div>
      <ul class="sofa-menu ant-menu ant-menu-horizontal ant-menu-light ant-menu-root" role="menu">
          <li class="ant-menu-item sofa-menu-item  ">
              <div class="sofa-menu-item-text">
                  <a href="/sofastack.github.io/docs">文档</a>
                  <a href="https://github.com/alipay">Github</a>
              </div>
          </li>
      </ul>
      <div class="sofa-menu-right pull-right">
      </div>
    </div>
  </div>
</div>
    <div class="main">
    <div class="pg-artical " id="pg-artical">
        <div class="wrap">
            <div class="nav-section">
                <div class="navbar">
                    <span class="larkicon larkicon-toc"></span>
                </div>
                <nav class="nav-container">
                    <ul class="catalog">
        <li class="current-book">
          <span class="name">SOFA-ARK</span>
        

        </li>
        
        <aside id="sidebar" role="navigation">
  <div class="inner">
    <li class="nav-item depth1 "><span href="" class="">产品介绍</span></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/index.html" class="">产品概述</a></li><li class="nav-item depth1 "><span href="" class="">快速开始</span></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-plugin-demo.html" class="">Ark-Plugin 工程演示</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-demo.html" class="">Ark 工程演示</a></li><li class="nav-item depth1 "><span href="" class="">用户文档</span></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/terminology.html" class="">名词解释</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-jar.html" class="">Ark 包</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-plugin.html" class="">Ark Plugin</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-biz.html" class="">Ark Biz</a></li><li class="nav-item depth1 "><span href="" class="">开发文档</span></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/startup.html" class="">Ark 容器启动流程</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/plugin.html" class="">Ark 容器插件机制</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/classloader.html" class="">Ark 容器类加载机制</a></li>
  </div>
</aside>
      
    </ul>
  </nav>
</div>
        <div class="main-container">
          <div id="page-toc"></div>
          <div class="artical-section larksite">
    <div class="doc-article">
      <article class="doc-article-inner">
        <div class="typo">
          <h1 class="typo-title" itemprop="title">
          
          </h1>
          <div class="typo-content">
            <blockquote>
<p><a href="https://github.com/alipay/sofa-ark/tree/master/sofa-ark-samples/sample-springboot-ark" target="_blank" rel="noopener">工程地址</a></p>
</blockquote>
<h2 id="简介" class="article-heading"><a href="#简介" class="headerlink" title="简介"></a>简介<a class="article-anchor" href="#简介" aria-hidden="true"></a></h2><p>该样例工程演示了如何借助 <code>Maven</code> 插件将一个 Spring Boot Web 工程打包成标准格式规范的可执行 Ark 包；</p>
<h2 id="准备" class="article-heading"><a href="#准备" class="headerlink" title="准备"></a>准备<a class="article-anchor" href="#准备" aria-hidden="true"></a></h2><p>因该样例工程依赖 <a href="https://github.com/alipay/sofa-ark/tree/master/sofa-ark-samples/sample-ark-plugin" target="_blank" rel="noopener">sample-ark-plugin</a> , 因此需要提前在本地安装该 <code>Ark Plugin</code> </p>
<h2 id="工具" class="article-heading"><a href="#工具" class="headerlink" title="工具"></a>工具<a class="article-anchor" href="#工具" aria-hidden="true"></a></h2><p>官方提供了 <code>Maven</code> 插件 - <code>sofa-ark-maven-plugin</code> ，只需要简单的配置项，即可将 Spring Boot Web 工程打包成标准格式规范的可执行 Ark 包，插件坐标为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sofa-ark-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="sofastack.github.io/docs/ark-jar.html">详细请参考插件使用文档</a></p>
</blockquote>
<h2 id="入门" class="article-heading"><a href="#入门" class="headerlink" title="入门"></a>入门<a class="article-anchor" href="#入门" aria-hidden="true"></a></h2><p>基于该样例工程，我们一步步描述如何将一个 Spring Boot Web 工程打包成可运行 Ark 包</p>
<h3 id="创建-SpringBoot-Web-工程" class="article-heading"><a href="#创建-SpringBoot-Web-工程" class="headerlink" title="创建 SpringBoot Web 工程"></a>创建 SpringBoot Web 工程<a class="article-anchor" href="#创建-SpringBoot-Web-工程" aria-hidden="true"></a></h3><p>在官网 <a href="https://start.spring.io/" target="_blank" rel="noopener">https://start.spring.io/</a> 下载一个标准的 Spring Boot Web 工程</p>
<h3 id="引入-sample-ark-plugin" class="article-heading"><a href="#引入-sample-ark-plugin" class="headerlink" title="引入 sample-ark-plugin"></a>引入 sample-ark-plugin<a class="article-anchor" href="#引入-sample-ark-plugin" aria-hidden="true"></a></h3><p>在工程主 <code>pom.xml</code> 中如下配置，添加另一个样例工程打包生成的 <code>Ark Plugin</code> 依赖，<a href="sofastack.github.io/docs/ark-plugin-demo.html">参考文档</a> </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sample-ark-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>ark-plugin<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="配置打包插件" class="article-heading"><a href="#配置打包插件" class="headerlink" title="配置打包插件"></a>配置打包插件<a class="article-anchor" href="#配置打包插件" aria-hidden="true"></a></h3><p>在工程主 <code>pom.xml</code> 中如下配置 <code>Maven</code> 插件 <code>sofa-ark-maven-plugin</code> :</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sofa-ark-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>default-cli<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">&lt;!--goal executed to generate executable-ark-jar --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    </span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!--specify destination where executable-ark-jar will be saved, default saved to $&#123;project.build.directory&#125;--&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>./target<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                        </span><br><span class="line">                        <span class="comment">&lt;!--default none--&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">arkClassifier</span>&gt;</span>executable-ark<span class="tag">&lt;/<span class="name">arkClassifier</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在该样例工程中，我们只配置了一部分配置项，这已经足够生成一个可用的可执行 <code>Ark</code> 包，各配置项含义如下：</p>
<ul>
<li><p>outputDirectory: <code>mvn package</code> 打包后，输出的 <code>Ark</code> 包文件存放目录；</p>
</li>
<li><p>arkClassifier: 指定发布的 <code>Ark</code> 包其 <code>Maven</code> 坐标包含的 <code>classifier</code> 值，默认为空；</p>
</li>
</ul>
<p><strong>关于 arkClassifier 配置项需要特别注意下，默认值为空；如果不指定 classifier ，上传到仓库的 Jar 包其实是一个可运行的 Ark 包；如果需要和普通的打包加以区分，需要配置该项值。</strong></p>
<h3 id="打包、安装、发布" class="article-heading"><a href="#打包、安装、发布" class="headerlink" title="打包、安装、发布"></a>打包、安装、发布<a class="article-anchor" href="#打包、安装、发布" aria-hidden="true"></a></h3><p>和普通的工程操作类似，使用 <code>mvn package</code> , <code>mvn install</code> , <code>mvn deploy</code> 即可完成插件包的安装和发布；</p>
<h3 id="运行" class="article-heading"><a href="#运行" class="headerlink" title="运行"></a>运行<a class="article-anchor" href="#运行" aria-hidden="true"></a></h3><p>我们提供了两种方式在 Ark 容器上启动工程应用，通过命令行启动或者在 IDE 启动；在 IDE 启动时，需要额外添加依赖；使用命令行启动非常简便，直接使用 <code>java -jar</code> 即可启动应用；下面我们说下如何在 IDE 启动 Ark 应用；</p>
<ul>
<li>Spring Boot 工程：Spring Boot 工程需要添加如下依赖即可：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sofa-ark-springboot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>普通 Java 工程： 相较于 SpringBoot 工程，普通的 Java  工程需要添加另一个依赖：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sofa-ark-support-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>除此之外，还需要在工程 <code>main</code> 方法最开始处，执行容器启动，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123; </span><br><span class="line">        SofaArkBootstrap.launch(args);</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="运行测试用例" class="article-heading"><a href="#运行测试用例" class="headerlink" title="运行测试用例"></a>运行测试用例<a class="article-anchor" href="#运行测试用例" aria-hidden="true"></a></h3><p>SOFAArk 提供了 <code>org.junit.runner.Runner</code> 的两个实现类，<code>ArkJUnit4Runner</code> 和 <code>ArkBootRunner</code>，分别用于集成 JUnit4 测试框架和 Spring Test；</p>
<h4 id="ArkJUnit4Runner" class="article-heading"><a href="#ArkJUnit4Runner" class="headerlink" title="ArkJUnit4Runner"></a>ArkJUnit4Runner<a class="article-anchor" href="#ArkJUnit4Runner" aria-hidden="true"></a></h4><p><code>ArkJUnit4Runner</code> 类似 <code>JUnit4</code>，使用注解 <code>ArkJUnit4Runner</code>，即可在 SOFAArk 容器之上运行普通的 JUnit4 测试用例；示范代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(ArkJUnit4Runner.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnitTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Assert.assertTrue(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ArkJUnit4Runner</code> 和 <code>JUnit4</code> 使用基本完全一致，<code>JUnit4</code> 测试框架的其他特性都能够完全兼容，</p>
<h4 id="ArkBootRunner" class="article-heading"><a href="#ArkBootRunner" class="headerlink" title="ArkBootRunner"></a>ArkBootRunner<a class="article-anchor" href="#ArkBootRunner" aria-hidden="true"></a></h4><p><code>ArkBootRunner</code> 类似 <code>SpringRunner</code>，参考<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-testing.html" target="_blank" rel="noopener">文档</a>学习 <code>SpringRunner</code> 的用法；为了能够在 SOFAArk 容器之上运行 Spring Boot 测试用例，只需要简单使用 <code>@RunWith(ArkBootRunner.class)</code> 替代 <code>@RunWith(SpringRunner.class)</code> 即可；示范代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith</span>(ArkBootRunner.class)</span><br><span class="line"><span class="meta">@SpringBootTest</span>(classes = SpringbootDemoApplication.class)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntegrationTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SampleService sampleService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Assert.assertTrue(<span class="string">"A Sample Service"</span>.equals(sampleService.service()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ArkBootRunner</code> 和 <code>SpringRunner</code> 使用基本完全一致；</p>

          </div>
        </div>
      </article>
    </div>
  </div>
        </div>
      </div>
    </div>
    <div class="mask hidden"></div>
  

  <script src="https://gw.alipayobjects.com/as/g/lark/site-toc/2.0.9/toc.js"></script>
<script>
  $('#page-toc').generateToc({
    contentContainer: $('.typo'),
    hasFirstLevelHeader: false,
    offsetTop: 0,
    affix: {
      bgColor: "transparent",
    },
  })
</script>



    </div>



    <div class="ant-row footer">
  <div class="footer-content">
    <div class="ant-row footer-desc">
      <div class="ant-col-8 ant-col-offset-2 footer-team">
        <h4>SOFA</h4>
        <p><a href="http://alipay.github.io/sofastack.github.io">首页</a></p>
        <p><a href="http://alipay.github.io/sofastack.github.io/docs">文档</a></p>
      </div>
      <div class="ant-col-4 ant-col-offset-2 footer-friend">
        <h4>社区</h4>
        <p><a href="https://github.com/alipay">Github</a></p>
        <p><a href="https://github.com/alipay/sofa-ark/issues">Issues</a></p>
      </div>
      <div class="ant-col-6 ant-col-offset-2 footer-contact">
      
      </div>
    </div>
    <div class="copyright">
    </div>
  </div>
</div>
</body>
</html>