<!DOCTYPE html>
<html lang="default">
<head>
	<meta name="generator" content="Hugo 0.24.1" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="base-url" content="/">
    <link type="image/png" href="https://gw.alipayobjects.com/zos/rmsportal/tRXQtrTrncqqhetSGTQP.png" rel="shortcut icon" />
    <base href="/">
    <link rel="stylesheet" href="/sofastack.github.io/css/sofa.css" rel="stylesheet">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_18677_3gesaak2gctyb9.css">
    <link href="//a.alipayobjects.com/g/lark/lark-markdown/1.3.18/default.css" rel="stylesheet">
    <link href="https://gw.alipayobjects.com/os/skylark/KIxlVLTkLQVFFoYBWDbT.css" rel="stylesheet">
    <link href="https://gw.alipayobjects.com/os/skylark/FEJbjjFlOklxrFRcJlEt.css" rel="stylesheet">
    <title>sofastack</title>
    <script src="https://gw.alipayobjects.com/os/skylark/lzusIxsuPvIxUYowbfNY.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://gw.alipayobjects.com/os/skylark/DNXLotCBHDrtZnOcOSgz.js" type="text/javascript" charset="utf-8"></script>
  </head>
<body data-url="/" class="theme1">
    <div class="header">
  <div>
    <div class="header-wrapper">
      <div class="header-logo">
        <a href=/sofastack.github.io>
          <img src="https://gw.alipayobjects.com/zos/rmsportal/tXhjeqVBFJnDSGScZrcW.png" alt="">
        </a>
      </div>
      <ul class="sofa-menu ant-menu ant-menu-horizontal ant-menu-light ant-menu-root" role="menu">
          <li class="ant-menu-item sofa-menu-item  ">
              <div class="sofa-menu-item-text">
                  <a href="/sofastack.github.io/docs">文档</a>
                  <a href="https://github.com/alipay">Github</a>
              </div>
          </li>
      </ul>
      <div class="sofa-menu-right pull-right">
      </div>
    </div>
  </div>
</div>
    <div class="main">
    <div class="pg-artical " id="pg-artical">
        <div class="wrap">
            <div class="nav-section">
                <div class="navbar">
                    <span class="larkicon larkicon-toc"></span>
                </div>
                <nav class="nav-container">
                    <ul class="catalog">
        <li class="current-book">
          <span class="name">SOFA-ARK</span>
        

        </li>
        
        <aside id="sidebar" role="navigation">
  <div class="inner">
    <li class="nav-item depth1 "><span href="" class="">产品介绍</span></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/index.html" class="">产品概述</a></li><li class="nav-item depth1 "><span href="" class="">快速开始</span></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-plugin-demo.html" class="">Ark-Plugin 工程演示</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-demo.html" class="">Ark 工程演示</a></li><li class="nav-item depth1 "><span href="" class="">用户文档</span></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/terminology.html" class="">名词解释</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-jar.html" class="">Ark 包</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-plugin.html" class="">Ark Plugin</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-biz.html" class="">Ark Biz</a></li><li class="nav-item depth1 "><span href="" class="">开发文档</span></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/startup.html" class="">Ark 容器启动流程</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/plugin.html" class="">Ark 容器插件机制</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/classloader.html" class="">Ark 容器类加载机制</a></li>
  </div>
</aside>
      
    </ul>
  </nav>
</div>
        <div class="main-container">
          <div id="page-toc"></div>
          <div class="artical-section larksite">
    <div class="doc-article">
      <article class="doc-article-inner">
        <div class="typo">
          <h1 class="typo-title" itemprop="title">
          
          </h1>
          <div class="typo-content">
            <blockquote>
<p><a href="https://github.com/alipay/sofa-ark/tree/master/sofa-ark-samples/sample-ark-plugin" target="_blank" rel="noopener">工程地址</a></p>
</blockquote>
<h2 id="简介" class="article-heading"><a href="#简介" class="headerlink" title="简介"></a>简介<a class="article-anchor" href="#简介" aria-hidden="true"></a></h2><p>该样例工程演示了如何借助 <code>maven</code> 插件将一个普通的 Java 工程打包成标准格式规范的 <code>Ark Plugin</code> </p>
<h2 id="背景" class="article-heading"><a href="#背景" class="headerlink" title="背景"></a>背景<a class="article-anchor" href="#背景" aria-hidden="true"></a></h2><p>现实开发中，常常会遇到依赖包冲突的情况；假设我们开发了一个类库 <code>sample-lib</code> , 业务应用在引入使用时，可能存在跟已有的依赖发生冲突的情况；通常这个时候，我们会希望自己的类库能够和业务其他依赖进行隔离，互不协商双方依赖包版本。 <code>Ark Plugin</code> 正是基于这种需求背景下的实践产物； <code>Ark Plugin</code> 运行在 <code>Ark Container</code> 之上，由容器负责加载启动，任何一个 <code>Ark Plugin</code> 由独立的 ClassLoader 加载，从而做到相互隔离。<code>Ark Plugin</code> 存在四个概念：</p>
<ul>
<li><p>导入类：插件启动时，优先委托给导出该类的插件负责加载，如果加载不到，才会尝试从本插件内部加载；</p>
</li>
<li><p>导出类：其他插件如果导入了该类，优先从本插件加载；</p>
</li>
<li><p>导入资源：插件在查找资源时，优先委托给导出改资源的插件负责加载，如果加载不到，才会尝试从本插件内部加载；</p>
</li>
<li><p>导入资源：其他插件如果导入了该资源，优先从本插件加载；</p>
</li>
</ul>
<blockquote>
<p><a href="sofastack.github.io/docs/ark-plugin.html#插件规范">详细请参考插件规范</a></p>
</blockquote>
<h2 id="工具" class="article-heading"><a href="#工具" class="headerlink" title="工具"></a>工具<a class="article-anchor" href="#工具" aria-hidden="true"></a></h2><p>官方提供了 <code>Maven</code> 插件 - <code>sofa-ark-plugin-maven-plugin</code> ，只需要简单的配置项，即可将普通的 Java 工程打包成标准格式规范的 <code>Ark Plugin</code> ，插件坐标为:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sofa-ark-plugin-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="sofastack.github.io/docs/ark-plugin.html#完整配置模板">详细请参考插件配置文档</a></p>
</blockquote>
<h2 id="入门" class="article-heading"><a href="#入门" class="headerlink" title="入门"></a>入门<a class="article-anchor" href="#入门" aria-hidden="true"></a></h2><p>基于该用例工程，我们一步步描述如何构建一个 <code>Ark Plugin</code> </p>
<h3 id="创建标准-Maven-工程" class="article-heading"><a href="#创建标准-Maven-工程" class="headerlink" title="创建标准 Maven 工程"></a>创建标准 Maven 工程<a class="article-anchor" href="#创建标准-Maven-工程" aria-hidden="true"></a></h3><p>该用例工程是一个标准的 Maven 工程，一共包含两个模块：</p>
<ul>
<li><p>common 模块：包含了插件导出类</p>
</li>
<li><p>plugin 模块：包含了 <code>com.alipay.sofa.ark.spi.service.PluginActivator</code> 接口实现类和一个插件服务类，插件打包工具 <code>sofa-ark-plugin-maven-plugin</code> 即配置在该模块的 <code>pom.xml</code> 中；</p>
</li>
</ul>
<h3 id="配置打包插件" class="article-heading"><a href="#配置打包插件" class="headerlink" title="配置打包插件"></a>配置打包插件<a class="article-anchor" href="#配置打包插件" aria-hidden="true"></a></h3><p>在 plugin 模块的 <code>pom.xml</code> 中按如下配置打包插件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sofa-ark-plugin-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">id</span>&gt;</span>default-cli<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>ark-plugin<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">&lt;!--can only configure no more than one activator--&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">activator</span>&gt;</span>com.alipay.sofa.ark.sample.activator.SamplePluginActivator<span class="tag">&lt;/<span class="name">activator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">&lt;!-- configure exported class --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exported</span>&gt;</span></span><br><span class="line">                            <span class="comment">&lt;!-- configure package-level exported class--&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">packages</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">package</span>&gt;</span>com.alipay.sofa.ark.sample.common<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">packages</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                            <span class="comment">&lt;!-- configure class-level exported class --&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">classes</span>&gt;</span></span><br><span class="line">                                <span class="tag">&lt;<span class="name">class</span>&gt;</span>com.alipay.sofa.ark.sample.facade.SamplePluginService<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">classes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exported</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">&lt;!--specify destination where ark-plugin will be saved, default saved to $&#123;project.build.directory&#125;--&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>../target<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在用例工程中，我们只配置了一部分配置项，这已经足够生成一个可用的 <code>Ark Plugin</code>，各配置项含义如下：</p>
<ul>
<li><p>activator: Ark 容器启动插件的入口类，最多只能配置一个；通常来说，在插件的 <code>activator</code> 会执行一些初始化操作，比如发布插件服务；在本样例工程中，即发布了插件服务。</p>
</li>
<li><p>导出包：包级别的导出类配置，插件中所有以导出包名为前缀的类，包括插件的三方依赖包，都会被导出；</p>
</li>
<li><p>导出类：精确类名的导出类配置，导出具体的类；</p>
</li>
<li><p>outputDirectory： <code>mvn package</code> 打包后，输出的 ark plugin 文件存放目录；</p>
</li>
</ul>
<p>需要指出的是，在用例工程中，我们只导出了工程创建的类；实际在使用时，也可以把工程依赖的三方包也导出去。</p>
<h3 id="打包、安装、发布、引入" class="article-heading"><a href="#打包、安装、发布、引入" class="headerlink" title="打包、安装、发布、引入"></a>打包、安装、发布、引入<a class="article-anchor" href="#打包、安装、发布、引入" aria-hidden="true"></a></h3><p>和普通的工程操作类似，使用 <code>mvn package</code> , <code>mvn install</code> , <code>mvn deploy</code> 即可完成插件包的安装和发布；需要注意的是，默认发布的 <code>Ark Plugin</code> 其 Maven 坐标会增加 <code>classifier=ark-plugin</code> ；例如在该样例工程中，如果需要使用该 ark plugin，必须如下配置依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sample-ark-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>ark-plugin<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

          </div>
        </div>
      </article>
    </div>
  </div>
        </div>
      </div>
    </div>
    <div class="mask hidden"></div>
  

  <script src="https://gw.alipayobjects.com/as/g/lark/site-toc/2.0.9/toc.js"></script>
<script>
  $('#page-toc').generateToc({
    contentContainer: $('.typo'),
    hasFirstLevelHeader: false,
    offsetTop: 0,
    affix: {
      bgColor: "transparent",
    },
  })
</script>



    </div>



    <div class="ant-row footer">
  <div class="footer-content">
    <div class="ant-row footer-desc">
      <div class="ant-col-8 ant-col-offset-2 footer-team">
        <h4>SOFA</h4>
        <p><a href="http://alipay.github.io/sofastack.github.io">首页</a></p>
        <p><a href="http://alipay.github.io/sofastack.github.io/docs">文档</a></p>
      </div>
      <div class="ant-col-4 ant-col-offset-2 footer-friend">
        <h4>社区</h4>
        <p><a href="https://github.com/alipay">Github</a></p>
        <p><a href="https://github.com/alipay/sofa-ark/issues">Issues</a></p>
      </div>
      <div class="ant-col-6 ant-col-offset-2 footer-contact">
      
      </div>
    </div>
    <div class="copyright">
    </div>
  </div>
</div>
</body>
</html>