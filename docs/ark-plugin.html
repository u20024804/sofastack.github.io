<!DOCTYPE html>
<html lang="default">
<head>
	<meta name="generator" content="Hugo 0.24.1" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="base-url" content="/">
    <link type="image/png" href="https://gw.alipayobjects.com/zos/rmsportal/tRXQtrTrncqqhetSGTQP.png" rel="shortcut icon" />
    <base href="/">
    <link rel="stylesheet" href="/sofastack.github.io/css/sofa.css" rel="stylesheet">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_18677_3gesaak2gctyb9.css">
    <link href="//a.alipayobjects.com/g/lark/lark-markdown/1.3.18/default.css" rel="stylesheet">
    <link href="https://gw.alipayobjects.com/os/skylark/KIxlVLTkLQVFFoYBWDbT.css" rel="stylesheet">
    <link href="https://gw.alipayobjects.com/os/skylark/FEJbjjFlOklxrFRcJlEt.css" rel="stylesheet">
    <title>sofastack</title>
    <script src="https://gw.alipayobjects.com/os/skylark/lzusIxsuPvIxUYowbfNY.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://gw.alipayobjects.com/os/skylark/DNXLotCBHDrtZnOcOSgz.js" type="text/javascript" charset="utf-8"></script>
  </head>
<body data-url="/" class="theme1">
    <div class="header">
  <div>
    <div class="header-wrapper">
      <div class="header-logo">
        <a href=/sofastack.github.io>
          <img src="https://gw.alipayobjects.com/zos/rmsportal/tXhjeqVBFJnDSGScZrcW.png" alt="">
        </a>
      </div>
      <ul class="sofa-menu ant-menu ant-menu-horizontal ant-menu-light ant-menu-root" role="menu">
          <li class="ant-menu-item sofa-menu-item  ">
              <div class="sofa-menu-item-text">
                  <a href="/sofastack.github.io/docs">文档</a>
                  <a href="https://github.com/alipay">Github</a>
              </div>
          </li>
      </ul>
      <div class="sofa-menu-right pull-right">
      </div>
    </div>
  </div>
</div>
    <div class="main">
    <div class="pg-artical " id="pg-artical">
        <div class="wrap">
            <div class="nav-section">
                <div class="navbar">
                    <span class="larkicon larkicon-toc"></span>
                </div>
                <nav class="nav-container">
                    <ul class="catalog">
        <li class="current-book">
          <span class="name">SOFA-ARK</span>
        

        </li>
        
        <aside id="sidebar" role="navigation">
  <div class="inner">
    <li class="nav-item depth1 "><span href="" class="">产品介绍</span></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/index.html" class="">产品概述</a></li><li class="nav-item depth1 "><span href="" class="">快速开始</span></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-plugin-demo.html" class="">Ark-Plugin 工程演示</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-demo.html" class="">Ark 工程演示</a></li><li class="nav-item depth1 "><span href="" class="">用户文档</span></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/terminology.html" class="">名词解释</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-jar.html" class="">Ark 包</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-plugin.html" class="">Ark Plugin</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/ark-biz.html" class="">Ark Biz</a></li><li class="nav-item depth1 "><span href="" class="">开发文档</span></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/startup.html" class="">Ark 容器启动流程</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/plugin.html" class="">Ark 容器插件机制</a></li><li class="nav-item depth2 "><a href="sofastack.github.io/docs/classloader.html" class="">Ark 容器类加载机制</a></li>
  </div>
</aside>
      
    </ul>
  </nav>
</div>
        <div class="main-container">
          <div id="page-toc"></div>
          <div class="artical-section larksite">
    <div class="doc-article">
      <article class="doc-article-inner">
        <div class="typo">
          <h1 class="typo-title" itemprop="title">
          Ark Plugin
          </h1>
          <div class="typo-content">
            <p>本小节将介绍 <code>Ark Plugin</code> 的标准规范和目录结构，以及如何使用官方插件 <code>sofa-ark-plugin-maven-plugin</code> 打包发布 <code>Ark Plugin</code>。</p>
<h2 id="插件规范" class="article-heading"><a href="#插件规范" class="headerlink" title="插件规范"></a>插件规范<a class="article-anchor" href="#插件规范" aria-hidden="true"></a></h2><p>标准的 <code>Ark Plugin</code> 需要满足以下规范：</p>
<ul>
<li><p>插件必须配置插件名，默认为 <code>${artifactId}</code> ；运行时，不允许存在同名的插件，可以认为它是 <code>Ark Plugin</code> 的唯一 ID;</p>
</li>
<li><p>插件必须配置优先级，默认为1000，数字越低表示优先级越高；</p>
</li>
<li><p>插件最多配置一个入口类 <code>activator</code> ，它是容器启动插件的入口，统一实现 <code>com.alipay.sofa.ark.spi.service.PluginActivator</code> 接口类；优先级高的插件优先启动；</p>
</li>
<li><p>导入类支持 package 和 class 两个级别；导入类优先从其他的插件加载；</p>
</li>
<li><p>导出类支持 package 和 class 两个级别；优先级高的插件优先导出；</p>
</li>
<li><p>支持导入 classpath 中资源，不支持通配符；优先从其他插件中查找指定资源；</p>
</li>
<li><p>支持导出 classpath 中资源，不支持通配符；优先级高的插件优先导出；</p>
</li>
</ul>
<h2 id="Maven-插件" class="article-heading"><a href="#Maven-插件" class="headerlink" title="Maven 插件"></a>Maven 插件<a class="article-anchor" href="#Maven-插件" aria-hidden="true"></a></h2><p>官方提供 <code>Maven</code> 插件 <code>sofa-ark-plugin-maven-plugin</code> 可以将工程打包成标准格式的 <code>Ark Plugin</code> ； <code>Maven</code> 插件坐标为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sofa-ark-plugin-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="Goals" class="article-heading"><a href="#Goals" class="headerlink" title="Goals"></a>Goals<a class="article-anchor" href="#Goals" aria-hidden="true"></a></h2><p><code>sofa-ark-plugin-maven-plugin</code> 插件提供 <code>goal: ark-plugin</code>，可以将工程打包成标准格式的 <code>Ark Plugin</code>, 如下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sofa-ark-plugin-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>default-cli<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goal</span>&gt;</span>ark-plugin<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">excution</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 配置信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="完整配置模板" class="article-heading"><a href="#完整配置模板" class="headerlink" title="完整配置模板"></a>完整配置模板<a class="article-anchor" href="#完整配置模板" aria-hidden="true"></a></h2><p>完整的 <code>sofa-ark-plugin-maven-plugin</code> 插件配置模板如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sofa-ark-plugin-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">id</span>&gt;</span>default-cli<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goal</span>&gt;</span>ark-plugin<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">                    <span class="comment">&lt;!-- 指定打包的 $&#123;pluginName&#125;.ark.plugin 存放目录; 默认放在 $&#123;project.build.directory&#125; --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>./<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">                    <span class="comment">&lt;!-- 是否把 ark plugin 安装、发布到仓库，默认为true --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">attach</span>&gt;</span>true<span class="tag">&lt;/<span class="name">attach</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- ark plugin 最多仅能指定一个 com.alipay.sofa.ark.spi.service.PluginActivator 接口实现类 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">activator</span>&gt;</span>com.alipay.sofa.ark.service.impl.SampleActivator<span class="tag">&lt;/<span class="name">activator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- 配置优先级，数字越小，优先级越高，优先启动，优先导出类，默认1000 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">priority</span>&gt;</span>2000<span class="tag">&lt;/<span class="name">priority</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- 配置插件的名字，务必配置对，运行时，是插件的唯一标识 ID。比如 sofa-rpc 插件，可以配置为 sofa-rpc; 默认为 $&#123;artifactId&#125; --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">pluginName</span>&gt;</span>$&#123;ark.plugin.name&#125;<span class="tag">&lt;/<span class="name">pluginName</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- 配置导入类、资源 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">imported</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 配置需要优先从其他 ark plugin 加载的 package --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">packages</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">package</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">package</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">packages</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">&lt;!-- 配置需要优先从其他 ark plugin 加载的 class --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">classes</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">class</span>&gt;</span>com.alipay.sofa.rpc.config.ProviderConfig<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">classes</span>&gt;</span></span><br><span class="line">                        </span><br><span class="line">                        <span class="comment">&lt;!-- 配置需要优先从其他 ark plugin 加载的资源 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">resource</span>&gt;</span>META-INF/spring/bean.xml<span class="tag">&lt;/<span class="name">resource</span>&gt;</span>&gt;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">imported</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- 配置导出类、资源 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exported</span>&gt;</span></span><br><span class="line">                        <span class="comment">&lt;!-- 配置包级别导出的类 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">packages</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">package</span>&gt;</span>com.alipay.sofa.ark.service<span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">packages</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment">&lt;!-- 配置类级别导出类 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">classes</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">class</span>&gt;</span>com.alipay.sofa.ark.common.CommonUtils<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">class</span>&gt;</span>com.alipay.sofa.mock<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">classes</span>&gt;</span></span><br><span class="line">                        </span><br><span class="line">                        <span class="comment">&lt;!-- 配置 ark plugin 对外导出的资源 --&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">resource</span>&gt;</span>META-INF/spring/bean.xml<span class="tag">&lt;/<span class="name">resource</span>&gt;</span>&gt;</span><br><span class="line">                        <span class="tag">&lt;/<span class="name">resources</span>&gt;</span>                        </span><br><span class="line">                    <span class="tag">&lt;/<span class="name">exported</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- 打包插件时，排除指定的包依赖；格式为: $&#123;groupId:artifactId&#125; 或者 $&#123;groupId:artifactId:classifier&#125; --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>org.apache.commons:commons-lang3<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- 打包插件时，排除和指定 groupId 相同的包依赖 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludeGroupIds</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">excludeGroupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">excludeGroupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludeGroupIds</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                    <span class="comment">&lt;!-- 打包插件时，排除和指定 artifactId 相同的包依赖 --&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludeArtifactIds</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">excludeArtifactId</span>&gt;</span>sofa-ark-spi<span class="tag">&lt;/<span class="name">excludeArtifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludeArtifactIds</span>&gt;</span></span><br><span class="line"></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>配置项含义如下：</p>
<ul>
<li><p><code>outputDirectory</code>: 指定打包的 ${pluginName}.ark.plugin 存放目录; 默认放在 ${project.build.directory};</p>
</li>
<li><p><code>attach</code>: 是否把 ark plugin 安装、发布到仓库，默认为true; </p>
</li>
<li><p><code>activator</code>: ark plugin 最多仅能指定一个 <code>com.alipay.sofa.ark.spi.service.PluginActivator</code> 接口实现类;</p>
</li>
<li><p><code>priority</code>: 配置优先级，数字越小，优先级越高，优先启动，优先导出类，默认1000;</p>
</li>
<li><p><code>pluginName</code>: 配置插件的名字，务必配置对，运行时，是插件的唯一标识 ID。比如 sofa-rpc 插件，可以配置为 sofa-rpc; 默认为 ${artifactId};</p>
</li>
<li><p><code>imported</code>: 配置导入类、资源；</p>
</li>
<li><p><code>exported</code>: 配置导出类、资源；</p>
</li>
<li><p><code>excludes</code>: 打包插件时，排除指定的包依赖；格式为: ${groupId:artifactId} 或者 ${groupId:artifactId:classifier}；</p>
</li>
<li><p><code>excludeGroupIds</code>: 打包插件时，排除和指定 groupId 相同的包依赖；</p>
</li>
<li><p><code>excludeArtifactIds</code>: 打包插件时，排除和指定 artifactId 相同的包依赖；</p>
</li>
</ul>
<h2 id="构建" class="article-heading"><a href="#构建" class="headerlink" title="构建"></a>构建<a class="article-anchor" href="#构建" aria-hidden="true"></a></h2><p>对于普通的 Java 工程，为了生成标准的 <code>Ark Plugin</code> ，只需要三步操作：</p>
<ul>
<li>在工程根目录中新建一个空模块打包 <code>Ark Plugin</code>，定义插件坐标，假设为：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sofa-ark-plugin-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>在该模块的 pom.xml 文件中，添加工程其他模块和三方包依赖，并配置模板配置 <code>sofa-ark-plugin-maven-plugin</code> 插件；</p>
</li>
<li><p>在该模块目录或工程根目录中敲击 <code>mvn package</code> 命令，即可在配置的 <code>outputDirectory</code> 目录中生成 <code>ark-plugin-demo.ark.plugin</code> 插件文件；敲击 <code>mvn install</code> 命令，则会安装到本地 <code>Maven</code> 仓库；</p>
</li>
</ul>
<h2 id="发布" class="article-heading"><a href="#发布" class="headerlink" title="发布"></a>发布<a class="article-anchor" href="#发布" aria-hidden="true"></a></h2><p>在工程主 pom 中配置仓库地址，然后敲击 <code>mvn deploy</code> 命令，即可发布该 <code>Ark Plugin</code> ;需要指出的是，发布的 <code>Ark Plugin</code> 坐标会带上 <code>classifier = ark-plugin</code> ；如上述构建描述，会生成如下坐标的 <code>Ark Plugin</code> :</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alipay.sofa<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>sofa-ark-plugin-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>ark-plugin<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>其他应用通过该坐标即可引用该插件。</p>
<h2 id="Ark-Plugin-典型目录结构" class="article-heading"><a href="#Ark-Plugin-典型目录结构" class="headerlink" title="Ark Plugin 典型目录结构"></a>Ark Plugin 典型目录结构<a class="article-anchor" href="#Ark-Plugin-典型目录结构" aria-hidden="true"></a></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">│</span><br><span class="line">├── com</span><br><span class="line">│   └── alipay</span><br><span class="line">│       └── sofa</span><br><span class="line">│           └── ark</span><br><span class="line">│               └── plugin</span><br><span class="line">│                   └── mark</span><br><span class="line">│</span><br><span class="line">├── META-INF</span><br><span class="line">│   └── MANIFEST.MF</span><br><span class="line">│</span><br><span class="line">├── conf</span><br><span class="line">│   └── export.index</span><br><span class="line">└── lib</span><br><span class="line">    ├── commons-lang3-3.3.1.jar</span><br><span class="line">    ├── sample-plugin-1.0.0.jar</span><br><span class="line">    └── sample-plugin-common-1.0.0.jar</span><br></pre></td></tr></table></figure>
<p>上述目录结构相关文件和目录说明如下：</p>
<ul>
<li><p><code>com/alipay/sofa/ark/plugin/mark</code> ：标记文件，标记该 Jar 包是 <code>sofa-ark-plugin-maven-plugin</code> 打包生成的 <code>Ark Plugin</code> 文件。</p>
</li>
<li><p><code>META-INF/MANIFEST.MF</code> ：记录插件元信息，内容类似如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Manifest-Version: 1.0</span><br><span class="line">groupId: com.alipay.sofa</span><br><span class="line">artifactId: sample-plugin</span><br><span class="line">version: 1.0.0</span><br><span class="line">priority: 2000</span><br><span class="line">pluginName: sample-demo-plugin</span><br><span class="line">activator: com.alipay.sofa.ark.service.impl.SampleActivator</span><br><span class="line">import-packages: javax.servlet,org.springframework</span><br><span class="line">import-classes: com.alipay.sofa.rpc.config.ProviderConfig</span><br><span class="line">export-packages: com.alipay.sofa.ark.service</span><br><span class="line">export-classes: com.alipay.sofa.ark.common.CommonUtils,com.alipay.sofa.mock</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li><p><code>conf/export.index</code> ：插件导出类索引文件；为了避免在运行时计算插件 <code>export-packages</code> 下面具体的导出类，在打包生成 <code>Ark Plugin</code> 时，会生成插件所有导出类的索引文件，缩短 <code>Ark Container</code> 解析配置时间。而导入类只需要读取 <code>META-INF/MANIFEST.MF</code> 配置信息，直接比较 <code>import-packages</code> 和 <code>import-classes</code> 前缀即可，无需生成索引文件。</p>
</li>
<li><p><code>lib/</code> : lib 目录存放插件工程依赖的普通 Jar 包，一般包含插件需要和其他插件或者业务有隔离需求的 Jar 包；插件配置的导出类都包含在这些 Jar 包中。</p>
</li>
</ul>

          </div>
        </div>
      </article>
    </div>
  </div>
        </div>
      </div>
    </div>
    <div class="mask hidden"></div>
  

  <script src="https://gw.alipayobjects.com/as/g/lark/site-toc/2.0.9/toc.js"></script>
<script>
  $('#page-toc').generateToc({
    contentContainer: $('.typo'),
    hasFirstLevelHeader: false,
    offsetTop: 0,
    affix: {
      bgColor: "transparent",
    },
  })
</script>



    </div>



    <div class="ant-row footer">
  <div class="footer-content">
    <div class="ant-row footer-desc">
      <div class="ant-col-8 ant-col-offset-2 footer-team">
        <h4>SOFA</h4>
        <p><a href="http://alipay.github.io/sofastack.github.io">首页</a></p>
        <p><a href="http://alipay.github.io/sofastack.github.io/docs">文档</a></p>
      </div>
      <div class="ant-col-4 ant-col-offset-2 footer-friend">
        <h4>社区</h4>
        <p><a href="https://github.com/alipay">Github</a></p>
        <p><a href="https://github.com/alipay/sofa-ark/issues">Issues</a></p>
      </div>
      <div class="ant-col-6 ant-col-offset-2 footer-contact">
      
      </div>
    </div>
    <div class="copyright">
    </div>
  </div>
</div>
</body>
</html>